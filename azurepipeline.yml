pool:
  vmImage: ubuntu-16.04

steps:
- task: DockerInstaller@0
  displayName: 'Install Docker 17.09.0-ce'

- script: docker run --rm -ti --name zalenium -d -p 4444:4444 -e PULL_SELENIUM_IMAGE=true -v /var/run/docker.sock:/var/run/docker.sock -v /tmp/videos:/home/seluser/videos --privileged dosel/zalenium start
  displayName: 'docker prepared environment'


- script: docker run --network="host" -v "$PWD/target:/usr/target" lobo10.azurecr.io/testes-exemplo:latest mvn test -Denv=qa
  displayName: 'docker run testing'

- script: docker stop zalenium
  displayName: 'docker stop environment'
  condition: always()

- task: PublishTestResults@2
  displayName: 'Publish Test Results'
  inputs:
    testResultsFiles: 'target/xml-junit/junit.xml'
    failTaskOnFailedTests: true
    testRunTitle: 'Testes Automatizados'